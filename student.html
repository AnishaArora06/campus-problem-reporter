<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Problem - Campus Problem Reporter</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>Campus Problem Reporter</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="student.html" class="nav-link active">Report Problem</a></li>
                <li><a href="admin.html" class="nav-link">Admin Dashboard</a></li>
                <li><a href="index.html#team" class="nav-link">Team</a></li>
                <li><a href="index.html#contact" class="nav-link">Contact</a></li>
                <li><button id="theme-toggle" class="theme-toggle"><i class="fas fa-moon"></i></button></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>Report a Problem</h1>
                <p>Help us improve campus facilities by reporting issues you encounter</p>
            </div>

            <div class="form-container">
                <form class="problem-form" id="problemForm">
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" id="studentName" name="studentName" required>
                            <label for="studentName">Full Name</label>
                            <i class="fas fa-user form-icon"></i>
                        </div>
                        <div class="form-group">
                            <input type="text" id="rollNumber" name="rollNumber" required>
                            <label for="rollNumber">Roll Number</label>
                            <i class="fas fa-id-card form-icon"></i>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <select id="department" name="department" required>
                                <option value="">Select Department</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Electronics">Electronics</option>
                                <option value="Mechanical">Mechanical</option>
                                <option value="Civil">Civil</option>
                                <option value="Electrical">Electrical</option>
                                <option value="Chemical">Chemical</option>
                                <option value="Biotechnology">Biotechnology</option>
                                <option value="MBA">MBA</option>
                                <option value="Other">Other</option>
                            </select>
                            <label for="department">Department</label>
                            <i class="fas fa-graduation-cap form-icon"></i>
                        </div>
                        <div class="form-group">
                            <select id="category" name="category" required>
                                <option value="">Select Category</option>
                                <option value="Furniture">Furniture</option>
                                <option value="Infrastructure">Infrastructure</option>
                                <option value="Electronics">Electronics</option>
                                <option value="Cleanliness">Cleanliness</option>
                                <option value="Security">Security</option>
                                <option value="Others">Others</option>
                            </select>
                            <label for="category">Problem Category</label>
                            <i class="fas fa-tags form-icon"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="text" id="location" name="location" required>
                        <label for="location">Location (e.g., Library, Classroom 204, Canteen)</label>
                        <i class="fas fa-map-marker-alt form-icon"></i>
                    </div>

                    <div class="form-group">
                        <textarea id="problemDescription" name="problemDescription" required rows="5"></textarea>
                        <label for="problemDescription">Problem Description</label>
                        <i class="fas fa-comment-alt form-icon"></i>
                    </div>

                    <div class="form-group">
                        <select id="priority" name="priority" required>
                            <option value="">Select Priority</option>
                            <option value="Low">Low - Can wait</option>
                            <option value="Medium">Medium - Should be addressed soon</option>
                            <option value="High">High - Needs immediate attention</option>
                            <option value="Critical">Critical - Emergency</option>
                        </select>
                        <label for="priority">Priority Level</label>
                        <i class="fas fa-exclamation-triangle form-icon"></i>
                    </div>

                    <div class="form-group file-upload-group">
                        <input type="file" id="imageUpload" name="imageUpload" accept="image/*" multiple>
                        <label for="imageUpload" class="file-upload-label">
                            <i class="fas fa-camera"></i>
                            <span>Upload Images (Optional)</span>
                            <small>You can upload multiple images</small>
                        </label>
                        <div class="file-preview" id="filePreview"></div>
                    </div>

                    <div class="form-actions">
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-undo"></i>
                            Reset Form
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            Submit Report
                        </button>
                    </div>
                </form>
            </div>

            <!-- Success Modal -->
            <div class="modal" id="successModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="success-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h2>Report Submitted Successfully!</h2>
                    </div>
                    <div class="modal-body">
                        <p>Thank you for reporting this issue. Your report has been received and will be reviewed by our team.</p>
                        <div class="report-details">
                            <p><strong>Report ID:</strong> <span id="reportId"></span></p>
                            <p><strong>Status:</strong> <span class="status-badge status-pending">Pending Review</span></p>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-primary" onclick="closeModal()">
                            <i class="fas fa-check"></i>
                            Got it
                        </button>
                        <button class="btn btn-secondary" onclick="submitAnother()">
                            <i class="fas fa-plus"></i>
                            Submit Another
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Problems Section -->
            <section class="recent-problems">
                <h2>Recently Reported Problems</h2>
                <div class="problems-list"></div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Campus Problem Reporter</h3>
                    <p>Making campus life better, one problem at a time.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="student.html">Report Problem</a></li>
                        <li><a href="admin.html">Admin Dashboard</a></li>
                        <li><a href="index.html#team">Team</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="index.html#contact">Contact Us</a></li>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <p><i class="fas fa-phone"></i> +91 98765 43210</p>
                    <p><i class="fas fa-envelope"></i> support@campusproblemreporter.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Campus Problem Reporter. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Floating Action Button -->
    <a href="#problemForm" class="fab-button" title="Go to Form">
        <i class="fas fa-edit"></i>
    </a>

    <script src="js/script.js"></script>
    <script>
  // === IMAGE UPLOAD PREVIEW + VALIDATION ===
  document.getElementById("imageUpload").addEventListener("change", function (event) {
    const files = event.target.files;
    const previewContainer = document.getElementById("filePreview");
    previewContainer.innerHTML = "";

    for (let file of files) {
      // Check file type
      if (!file.type.match("image.*")) {
        alert("Only JPG, JPEG, or PNG images are allowed.");
        continue;
      }

      // Check size (max 2MB)
      if (file.size > 2 * 1024 * 1024) {
        alert(`${file.name} is too large. Max 2MB allowed.`);
        continue;
      }

      // Show preview
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = document.createElement("img");
        img.src = e.target.result;
        img.classList.add("preview-image");
        previewContainer.appendChild(img);
      };
      reader.readAsDataURL(file);
    }
  });

  // === FORM SUBMISSION FUNCTIONALITY ===
  document.getElementById("problemForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const formData = new FormData(this);

    const imageFiles = document.getElementById("imageUpload").files;
    for (let file of imageFiles) {
      formData.append("images", file);
    }

    try {
      const response = await fetch("/api/problems/report", {
        method: "POST",
        body: formData
      });

      if (response.ok) {
        const data = await response.json();
        // Show success modal
        document.getElementById("reportId").textContent = data.reportId || "Generated ID";
        document.getElementById("successModal").style.display = "flex";
        this.reset();
        document.getElementById("filePreview").innerHTML = "";
      } else {
        alert("❌ Failed to submit problem. Please try again.");
      }
    } catch (err) {
      console.error(err);
      alert("⚠️ Error connecting to server.");
    }
  });

  // === MODAL CONTROL ===
  function closeModal() {
    document.getElementById("successModal").style.display = "none";
  }

  function submitAnother() {
    document.getElementById("successModal").style.display = "none";
    document.getElementById("problemForm").scrollIntoView({ behavior: "smooth" });
  }

  // Make closeModal & submitAnother accessible globally
  window.closeModal = closeModal;
  window.submitAnother = submitAnother;
</script>
<script src="js/script.js"></script>

</body>
</html>